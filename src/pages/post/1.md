---
title: '本地 HTTPS 服务器小纸条'
pubDate: 2024-11-16
description: '在你的本地环境中启动一个 HTTPS 服务器'
author: 'Danny'
image:
    url: '1/1.jpg'
    alt: '一个很帅很酷的军人'
tags: ["web development", "https", "python"]
---

## 本地 HTTPS 服务器小纸条

最近想要尝试一下 Telegram mini app，在调试时需要使用 HTTPS 的服务。试来试去发现在 Mac 下完成一个简单的 HTTPS 服务器还是需要点奇奇怪怪的工具的。但是整体来讲非常简单。

### 准备证书

主要会使用 mkcert 来创建证书。首先安装 mkcert。

```sh
brew install mkcert
brew install nss # if use Firefox
```

将 mkcert 加入到本地 root CA。

```sh
mkcert -install
```

### 生成证书

本地调试可以使用 `localhost` 或 `127.0.0.1`，而这两个其实是两个域名，需要两套证书。

```sh
mkcert localhost
mkcert 127.0.0.1
```

这样它就会生成两个文件，一个是 key，一个是 cert。

### 启动 Web 服务器

我使用 Python 来启动一个简单的服务器。

```python
from http.server import HTTPServer, SimpleHTTPRequestHandler
import ssl

keyfile = "../127.0.0.1-key.pem"
certfile = '../127.0.0.1.pem'
hostname = '127.0.0.1'

context = ssl.create_default_context(ssl.Purpose.CLIENT_AUTH)
context.load_cert_chain(certfile=certfile, keyfile=keyfile)

httpd = HTTPServer((hostname, 4443), SimpleHTTPRequestHandler)
httpd.socket = context.wrap_socket(httpd.socket, server_side=True)
httpd.serve_forever()
```

这样你就可以通过 `https://127.0.0.1/` 来访问开发服务器了。